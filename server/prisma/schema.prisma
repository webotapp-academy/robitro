generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                String          @id @default(uuid())
  firstName         String
  lastName          String
  email             String          @unique
  password          String
  role              Role            @default(student)
  age               Int?
  parentName        String?
  parentPhone       String?
  schoolName        String?
  isVerified        Boolean         @default(false)
  status            String          @default("active")
  avatar            String?         @default("https://via.placeholder.com/150")
  bio               String?         @default("")
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  partnerId         String?
  comments          Comment[]
  posts             CommunityPost[]
  instructorCourses Course[]        @relation("InstructorCourses")
  enrollments       Enrollment[]
  orders            Order[]
  likedPosts        PostLike[]
  partner           Partner?        @relation(fields: [partnerId], references: [id])

  @@index([email])
  @@index([role])
}

model Partner {
  id                String      @id @default(uuid())
  name              String
  partnerType       PartnerType
  email             String      @unique
  phone             String
  address           Json?
  documents         Json?
  commissionPercent Float       @default(15)
  approved          Boolean     @default(false)
  contactPerson     Json?
  website           String?
  logo              String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  courses           Course[]
  products          Product[]
  users             User[]

  @@index([email])
  @@index([name])
}

model ProductCategory {
  id          String    @id @default(uuid())
  name        String    @unique
  slug        String    @unique
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]
}

model Product {
  id             String           @id @default(uuid())
  name           String
  description    String
  price          Float
  ageGroup       String
  images         String[]
  stock          Int              @default(0)
  rating         Float            @default(0)
  reviewsCount   Int              @default(0)
  specifications Json?            @default("{}")
  warranty       Json?
  status         ProductStatus    @default(active)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  partnerId      String?
  metadata       Json?            @default("{}")
  categoryId     String?
  categoryName   String?
  category       ProductCategory? @relation(fields: [categoryId], references: [id])
  partner        Partner?         @relation(fields: [partnerId], references: [id])

  @@index([categoryId])
  @@index([status])
}

model Course {
  id              String            @id @default(uuid())
  title           String
  description     String
  ageGroup        String
  level           CourseLevel       @default(beginner)
  price           Float             @default(0)
  thumbnail       String?           @default("https://via.placeholder.com/400x300")
  isLive          Boolean           @default(false)
  startDate       DateTime?
  endDate         DateTime?
  category        String
  rating          Float             @default(0)
  enrollmentCount Int               @default(0)
  status          CourseStatus      @default(draft)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  instructorId    String
  partnerId       String?
  metadata        Json?             @default("{}")
  callbacks       CallbackRequest[]
  instructor      User              @relation("InstructorCourses", fields: [instructorId], references: [id])
  partner         Partner?          @relation(fields: [partnerId], references: [id])
  enrollments     Enrollment[]
  leads           Lead[]
  modules         Module[]

  @@index([category])
  @@index([status])
}

model Module {
  id       String   @id @default(uuid())
  title    String
  order    Int
  courseId String
  lessons  Lesson[]
  course   Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
}

model Lesson {
  id        String   @id @default(uuid())
  title     String
  videoUrl  String
  duration  Int
  resources String[]
  order     Int
  moduleId  String
  module    Module   @relation(fields: [moduleId], references: [id], onDelete: Cascade)
}

model Enrollment {
  id                  String            @id @default(uuid())
  userId              String
  courseId            String
  enrolledAt          DateTime          @default(now())
  certificateIssued   Boolean           @default(false)
  certificateIssuedAt DateTime?
  certificateUrl      String?
  progressPercentage  Int               @default(0)
  status              EnrollmentStatus  @default(ongoing)
  paymentStatus       String            @default("pending")
  paymentAmount       Float             @default(0)
  paymentProof        String?
  transactionNumber   String?
  customerName        String?
  customerEmail       String?
  customerPhone       String?
  updatedAt           DateTime          @updatedAt
  completedLessons    CompletedLesson[]
  course              Course            @relation(fields: [courseId], references: [id])
  user                User              @relation(fields: [userId], references: [id])

  @@unique([userId, courseId])
}

model CompletedLesson {
  id           String     @id @default(uuid())
  enrollmentId String
  lessonId     String
  completedAt  DateTime   @default(now())
  enrollment   Enrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)

  @@unique([enrollmentId, lessonId])
}

model Order {
  id                String   @id @default(uuid())
  userId            String?
  items             Json[]
  totalAmount       Float
  currency          String   @default("GBP")
  status            String   @default("pending")
  paymentType       String?  @default("bank_transfer")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  customerEmail     String
  customerName      String
  customerPhone     String
  orderNotes        String?
  paymentProof      String?
  shipping          Float    @default(0)
  shippingAddress   String
  shippingCity      String
  shippingCountry   String   @default("United Kingdom")
  shippingPostcode  String
  subtotal          Float
  tax               Float    @default(0)
  trackingNumber    String?
  transactionNumber String?
  user              User?    @relation(fields: [userId], references: [id])

  @@index([status])
  @@index([customerEmail])
}

model CommunityPost {
  id            String     @id @default(uuid())
  title         String
  images        String[]
  status        PostStatus @default(published)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  category      String     @default("general")
  commentsCount Int        @default(0)
  description   String
  likesCount    Int        @default(0)
  userId        String
  viewsCount    Int        @default(0)
  comments      Comment[]
  author        User       @relation(fields: [userId], references: [id])
  likes         PostLike[]

  @@index([status])
  @@index([category])
}

model Comment {
  id         String        @id @default(uuid())
  content    String
  userId     String
  postId     String
  likesCount Int           @default(0)
  createdAt  DateTime      @default(now())
  post       CommunityPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  user       User          @relation(fields: [userId], references: [id])
}

model PostLike {
  id        String        @id @default(uuid())
  userId    String
  postId    String
  createdAt DateTime      @default(now())
  post      CommunityPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User          @relation(fields: [userId], references: [id])

  @@unique([userId, postId])
}

model HeroSection {
  id              String   @id @default(uuid())
  page            String   @default("home")
  title           String
  subtitle        String?
  ctaText         String?
  ctaLink         String?
  backgroundImage String?
  badgeText       String?
  isActive        Boolean  @default(true)
  displayOrder    Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([page, isActive])
}

model FeatureCard {
  id           String   @id @default(uuid())
  icon         String
  title        String
  description  String
  gradient     String
  image        String?
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([isActive])
}

model Testimonial {
  id           String   @id @default(uuid())
  name         String
  age          Int?
  country      String?
  quote        String
  avatar       String?
  rating       Int      @default(5)
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([isActive])
}

model FAQ {
  id           String   @id @default(uuid())
  question     String
  answer       String
  category     String   @default("general")
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([category, isActive])
}

model SiteSetting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  type      String   @default("text")
  group     String   @default("general")
  label     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([group])
}

model Banner {
  id           String    @id @default(uuid())
  title        String
  description  String?
  image        String?
  link         String?
  position     String    @default("top")
  isActive     Boolean   @default(true)
  startDate    DateTime?
  endDate      DateTime?
  displayOrder Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([position, isActive])
}

model TechBite {
  id           String   @id @default(uuid())
  title        String
  videoUrl     String
  thumbnail    String?
  views        Int      @default(0)
  duration     String?
  category     String   @default("general")
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([category, isActive])
}

model MasterMaker {
  id           String   @id @default(uuid())
  name         String
  role         String
  avatar       String?
  level        Int      @default(1)
  projects     Int      @default(0)
  followers    String?
  badge        String?
  gradient     String?
  profileUrl   String?
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([isActive])
}

model ProjectShowcase {
  id           String   @id @default(uuid())
  title        String
  author       String
  tag          String
  image        String?
  color        String?
  likes        Int      @default(0)
  category     String   @default("all")
  description  String?
  projectUrl   String?
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([category, isActive])
}

model Challenge {
  id              String    @id @default(uuid())
  title           String
  subtitle        String?
  description     String?
  prize           String?
  registeredCount Int       @default(0)
  startDate       DateTime?
  endDate         DateTime?
  registrationUrl String?
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([isActive])
}

model SocialLink {
  id            String   @id @default(uuid())
  platform      String
  url           String
  handle        String?
  followerCount String?
  icon          String?
  displayOrder  Int      @default(0)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([isActive])
}

model Lead {
  id        String   @id @default(uuid())
  name      String
  email     String
  phone     String
  courseId  String?
  status    String   @default("pending")
  type      String   @default("enrollment")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  course    Course?  @relation(fields: [courseId], references: [id])
}

model CallbackRequest {
  id            String   @id @default(uuid())
  name          String
  phone         String
  preferredTime String?
  courseId      String?
  status        String   @default("pending")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  course        Course?  @relation(fields: [courseId], references: [id])
}

enum Role {
  student
  partner
  admin
  instructor
}

enum PartnerType {
  school
  franchise
  institute
}

enum CourseLevel {
  beginner
  intermediate
  advanced
}

enum CourseStatus {
  draft
  published
  archived
}

enum ProductStatus {
  active
  inactive
  discontinued
}

enum PostStatus {
  draft
  published
  archived
}

enum EnrollmentStatus {
  ongoing
  completed
  dropped
}
